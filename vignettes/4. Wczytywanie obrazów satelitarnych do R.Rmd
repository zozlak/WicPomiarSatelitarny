---
title: "Wczytywanie obrazów satelitarnych do R"
author: "Mateusz Zółtak"
date: "30 lipca 2016"
output: html_document
---

# Przygotowanie

Załadujmy potrzebne pakiety i ściągnijmy obrazy satelitarne z serwera:

```{r, message=FALSE, warning=FALSE}
library(WicPomiarSatelitarny)

dir.create("dane", FALSE)
pobierzObrazy(21.5, 51.5, "2016-06-29", "2016-06-29", 50, "dane")
```

# aaa

```{r}

zdjecia = wczytajZdjecia("dane", "2016-06-29")
eksportujKolor(zdjecia[["B04"]], zdjecia[["B03"]], zdjecia[["B02"]], 'dane/rgb.tif', 0, 5000)
eksportujMono(zdjecia[["SCL"]], "dane/scl.tif", 0, 11, c('red', 'red', 'white', 'white', 'green', 'brown', 'blue', 'white', 'white', 'white', 'white', 'white'))

tmp = cut(zdjecia[["B04"]], breaks = c(100, 1000, 2000, 3000, 4000))
plot(tmp)
eksportujMono(tmp, "dane/tmp.tif", paleta = c('white', 'green'))


levelplot(zdjecia[['SCL']])
tmp = ratify(bands[['SCL']])
levels(tmp) = data.frame()

ggplot(values, aes(x = NDVI, y = LAI)) + geom_bin2d(binwidth = c(0.05, 100))
ggplot(values[values$SCL < 7 & values$SCL > 3, ], aes(x = NDVI, y = LAI)) + geom_bin2d(binwidth = c(0.05, 100))

out = raster('dane/B02.tiff')
out = setValues(out, ifelse(values$NDVI < 0.2 & values$NDVI > 0 & values$LAI > 1300 & values$LAI < 2000, 1, NA))


model = lm(LAI ~ B02 + B03 + B04 + B05 + B06 + B07 + B8A + B09 + B11 + B12, data = values[values$SCL < 7 & values$SCL > 3, ])

writeRaster(
  stack(bands[['B04']], bands[['B03']], bands[['B02']]), 
  'dane/rgb.tiff', 
  overwrite = TRUE,
  datatype = 'INT1U'
)
```